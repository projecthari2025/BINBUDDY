<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BinBuddy - Eco-Friendly Waste Management</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* Main Styles for BinBuddy */
    :root {
      /* Color System */
      --primary-50: #f0fdf4;
      --primary-100: #dcfce7;
      --primary-200: #bbf7d0;
      --primary-300: #86efac;
      --primary-400: #4ade80;
      --primary-500: #22c55e;
      --primary-600: #16a34a;
      --primary-700: #15803d;
      --primary-800: #166534;
      --primary-900: #14532d;
      
      --secondary-500: #3b82f6;
      --secondary-600: #2563eb;
      
      --accent-400: #fb923c;
      --accent-500: #f97316;
      --accent-600: #ea580c;
      
      --success-500: #10b981;
      --warning-500: #f59e0b;
      --error-500: #ef4444;
      
      --neutral-50: #f9fafb;
      --neutral-100: #f3f4f6;
      --neutral-200: #e5e7eb;
      --neutral-300: #d1d5db;
      --neutral-400: #9ca3af;
      --neutral-500: #6b7280;
      --neutral-600: #4b5563;
      --neutral-700: #374151;
      --neutral-800: #1f2937;
      --neutral-900: #111827;
      
      /* Typography */
      --font-family: 'Inter', system-ui, -apple-system, sans-serif;
      --font-size-xs: 0.75rem;
      --font-size-sm: 0.875rem;
      --font-size-base: 1rem;
      --font-size-lg: 1.125rem;
      --font-size-xl: 1.25rem;
      --font-size-2xl: 1.5rem;
      --font-size-3xl: 1.875rem;
      --font-size-4xl: 2.25rem;
      
      /* Spacing System */
      --spacing-1: 0.25rem;
      --spacing-2: 0.5rem;
      --spacing-3: 0.75rem;
      --spacing-4: 1rem;
      --spacing-6: 1.5rem;
      --spacing-8: 2rem;
      --spacing-12: 3rem;
      --spacing-16: 4rem;
      
      /* Shadows */
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      
      /* Transitions */
      --transition: all 0.2s ease;
      --transition-slow: all 0.3s ease;
      
      /* Border Radius */
      --radius-sm: 0.25rem;
      --radius-md: 0.375rem;
      --radius-lg: 0.5rem;
      --radius-xl: 0.75rem;
      --radius-full: 9999px;
    }

    /* Reset & Base Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      font-family: var(--font-family);
      color: var(--neutral-800);
      background-color: var(--neutral-50);
      line-height: 1.5;
      font-weight: 400;
    }

    h1, h2, h3, h4, h5, h6 {
      font-weight: 600;
      line-height: 1.2;
      margin-bottom: var(--spacing-4);
      color: var(--neutral-900);
    }

    h1 { font-size: var(--font-size-3xl); }
    h2 { font-size: var(--font-size-2xl); }
    h3 { font-size: var(--font-size-xl); }
    h4 { font-size: var(--font-size-lg); }

    a {
      color: var(--primary-600);
      text-decoration: none;
      transition: var(--transition);
    }

    a:hover {
      color: var(--primary-700);
      text-decoration: underline;
    }

    #app {
      min-height: 100%;
      display: flex;
      flex-direction: column;
    }

    /* Layout Components */
    .container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 var(--spacing-4);
    }

    .page {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Auth Pages */
    .auth-page {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, var(--primary-500), var(--primary-700));
      padding: var(--spacing-4);
    }

    .auth-container {
      width: 100%;
      max-width: 420px;
      background: var(--neutral-50);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg);
      padding: var(--spacing-8);
      animation: fadeIn 0.5s ease;
    }

    .auth-logo {
      text-align: center;
      margin-bottom: var(--spacing-6);
    }

    .auth-logo h1 {
      color: var(--primary-600);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-2);
    }

    .auth-logo i {
      font-size: var(--font-size-2xl);
    }

    .auth-tabs {
      display: flex;
      margin-bottom: var(--spacing-6);
      border-bottom: 1px solid var(--neutral-200);
    }

    .auth-tab {
      flex: 1;
      text-align: center;
      padding: var(--spacing-3) 0;
      cursor: pointer;
      font-weight: 500;
      color: var(--neutral-600);
      position: relative;
    }

    .auth-tab.active {
      color: var(--primary-600);
    }

    .auth-tab.active::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      width: 100%;
      height: 2px;
      background-color: var(--primary-600);
    }

    .auth-form h2 {
      margin-bottom: var(--spacing-6);
      text-align: center;
    }

    .form-group {
      margin-bottom: var(--spacing-4);
    }

    .form-group label {
      display: block;
      margin-bottom: var(--spacing-1);
      font-size: var(--font-size-sm);
      font-weight: 500;
      color: var(--neutral-700);
    }

    .form-control {
      width: 100%;
      padding: var(--spacing-3);
      font-size: var(--font-size-base);
      border: 1px solid var(--neutral-300);
      border-radius: var(--radius-md);
      transition: var(--transition);
    }

    .form-control:focus {
      outline: none;
      border-color: var(--primary-500);
      box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.2);
    }

    .btn {
      cursor: pointer;
      display: inline-block;
      padding: var(--spacing-3) var(--spacing-6);
      font-size: var(--font-size-base);
      font-weight: 500;
      text-align: center;
      border: none;
      border-radius: var(--radius-md);
      transition: var(--transition);
    }

    .btn-block {
      display: block;
      width: 100%;
    }

    .btn-primary {
      background-color: var(--primary-600);
      color: white;
    }

    .btn-primary:hover {
      background-color: var(--primary-700);
    }

    .btn-secondary {
      background-color: var(--neutral-200);
      color: var(--neutral-700);
    }

    .btn-secondary:hover {
      background-color: var(--neutral-300);
    }

    .auth-footer {
      text-align: center;
      margin-top: var(--spacing-6);
      color: var(--neutral-600);
      font-size: var(--font-size-sm);
    }

    /* Dashboard Layout */
    .dashboard {
      display: flex;
      min-height: 100vh;
    }

    .sidebar {
      width: 250px;
      background: linear-gradient(180deg, var(--primary-800), var(--primary-900));
      color: white;
      padding: var(--spacing-4) 0;
      transition: var(--transition-slow);
      z-index: 10;
    }

    .sidebar-header {
      padding: 0 var(--spacing-4);
      margin-bottom: var(--spacing-6);
      display: flex;
      align-items: center;
      gap: var(--spacing-2);
    }

    .sidebar-header h2 {
      color: white;
      margin-bottom: 0;
    }

    .sidebar-nav {
      list-style: none;
    }

    .sidebar-link {
      display: flex;
      align-items: center;
      gap: var(--spacing-3);
      padding: var(--spacing-3) var(--spacing-4);
      color: var(--neutral-200);
      transition: var(--transition);
      text-decoration: none;
      font-weight: 500;
    }

    .sidebar-link:hover {
      background-color: rgba(255, 255, 255, 0.1);
      color: white;
      text-decoration: none;
    }

    .sidebar-link.active {
      background-color: rgba(255, 255, 255, 0.15);
      color: white;
      border-left: 3px solid var(--primary-400);
    }

    .sidebar-link i {
      font-size: var(--font-size-lg);
      width: 24px;
      text-align: center;
    }

    .dashboard-content {
      flex: 1;
      overflow-y: auto;
    }

    .dashboard-header {
      background-color: white;
      padding: var(--spacing-4);
      box-shadow: var(--shadow-sm);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .user-menu {
      display: flex;
      align-items: center;
      gap: var(--spacing-2);
    }

    .toggle-sidebar {
      display: none;
      padding: var(--spacing-2);
      font-size: var(--font-size-xl);
      color: var(--neutral-600);
      cursor: pointer;
    }

    .main-content {
      padding: var(--spacing-6);
    }

    /* Cards and UI Components */
    .card {
      background-color: white;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow);
      padding: var(--spacing-6);
      margin-bottom: var(--spacing-6);
      transition: var(--transition);
    }

    .card:hover {
      box-shadow: var(--shadow-md);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-4);
    }

    .card-icon {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-full);
      background-color: var(--primary-100);
      color: var(--primary-600);
      font-size: var(--font-size-xl);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: var(--spacing-6);
    }

    .stat-card {
      background-color: white;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow);
      padding: var(--spacing-6);
      transition: var(--transition);
    }

    .stat-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .stat-icon {
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-full);
      margin-bottom: var(--spacing-4);
      font-size: var(--font-size-2xl);
    }

    .stat-icon.green {
      background-color: var(--primary-100);
      color: var(--primary-600);
    }

    .stat-icon.blue {
      background-color: rgba(59, 130, 246, 0.1);
      color: var(--secondary-600);
    }

    .stat-icon.orange {
      background-color: rgba(249, 115, 22, 0.1);
      color: var(--accent-600);
    }

    .stat-value {
      font-size: var(--font-size-3xl);
      font-weight: 600;
      margin-bottom: var(--spacing-2);
    }

    .stat-label {
      color: var(--neutral-600);
      font-size: var(--font-size-sm);
    }

    .gauge-container {
      margin: var(--spacing-4) 0;
      position: relative;
    }

    .gauge {
      width: 200px;
      height: 100px;
      margin: 0 auto;
      position: relative;
      overflow: hidden;
    }

    .gauge-bg {
      width: 200px;
      height: 200px;
      border-radius: 50%;
      border: 15px solid var(--neutral-200);
      border-bottom-color: transparent;
      border-left-color: transparent;
      border-right-color: transparent;
      box-sizing: border-box;
      position: absolute;
      top: 0;
    }

    .gauge-fill {
      width: 200px;
      height: 200px;
      border-radius: 50%;
      border: 15px solid var(--primary-500);
      border-bottom-color: transparent;
      border-left-color: transparent;
      border-right-color: transparent;
      box-sizing: border-box;
      position: absolute;
      top: 0;
      transform-origin: center center;
      transform: rotate(0deg);
      transition: transform 1s ease-out;
    }

    .gauge-cover {
      width: 130px;
      height: 65px;
      background-color: white;
      border-radius: 65px 65px 0 0;
      position: absolute;
      top: 15px;
      left: 35px;
    }

    .gauge-value {
      text-align: center;
      font-size: var(--font-size-xl);
      font-weight: 600;
      margin-top: var(--spacing-2);
    }

    .gauge-label {
      text-align: center;
      font-size: var(--font-size-sm);
      color: var(--neutral-600);
    }

    /* Action Cards */
    .action-cards {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: var(--spacing-6);
    }

    .action-card {
      background-color: white;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow);
      padding: var(--spacing-6);
      border-top: 4px solid var(--primary-500);
      transition: var(--transition);
      cursor: pointer;
    }

    .action-card:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-md);
    }

    .action-card h3 {
      display: flex;
      align-items: center;
      gap: var(--spacing-2);
    }

    .action-card i {
      color: var(--primary-600);
    }

    .action-card p {
      margin-bottom: var(--spacing-4);
      color: var(--neutral-600);
    }

    /* Forms on Dashboard */
    .form-card {
      background-color: white;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow);
      padding: var(--spacing-6);
      margin-bottom: var(--spacing-6);
    }

    .form-card h3 {
      margin-bottom: var(--spacing-4);
      display: flex;
      align-items: center;
      gap: var(--spacing-2);
    }

    .form-card i {
      color: var(--primary-600);
    }

    .form-row {
      display: flex;
      gap: var(--spacing-4);
      margin-bottom: var(--spacing-4);
    }

    .form-row .form-group {
      flex: 1;
      margin-bottom: 0;
    }

    /* Alert Component */
    .alert {
      padding: var(--spacing-3) var(--spacing-4);
      border-radius: var(--radius-md);
      margin-bottom: var(--spacing-4);
    }

    .alert-success {
      background-color: rgba(16, 185, 129, 0.1);
      border-left: 4px solid var(--success-500);
      color: var(--success-500);
    }

    .alert-warning {
      background-color: rgba(245, 158, 11, 0.1);
      border-left: 4px solid var(--warning-500);
      color: var(--warning-500);
    }

    .alert-error {
      background-color: rgba(239, 68, 68, 0.1);
      border-left: 4px solid var(--error-500);
      color: var(--error-500);
    }

    /* Table Styles */
    .table-container {
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: var(--spacing-3) var(--spacing-4);
      text-align: left;
      border-bottom: 1px solid var(--neutral-200);
    }

    th {
      font-weight: 600;
      color: var(--neutral-700);
      background-color: var(--neutral-100);
    }

    tr:hover td {
      background-color: var(--neutral-50);
    }

    /* Badge Component */
    .badge {
      display: inline-block;
      padding: var(--spacing-1) var(--spacing-2);
      border-radius: var(--radius-full);
      font-size: var(--font-size-xs);
      font-weight: 500;
    }

    .badge-success {
      background-color: rgba(16, 185, 129, 0.1);
      color: var(--success-500);
    }

    .badge-warning {
      background-color: rgba(245, 158, 11, 0.1);
      color: var(--warning-500);
    }

    .badge-primary {
      background-color: rgba(34, 197, 94, 0.1);
      color: var(--primary-600);
    }

    /* Reward Badge */
    .reward-badge {
      position: relative;
      display: inline-block;
      padding: var(--spacing-2) var(--spacing-4);
      background: linear-gradient(135deg, var(--accent-400), var(--accent-600));
      color: white;
      border-radius: var(--radius-md);
      font-weight: 600;
      box-shadow: var(--shadow);
      animation: pulse 2s infinite;
    }

    .reward-badge i {
      margin-right: var(--spacing-2);
    }

    /* Modal Component */
    .modal-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: var(--transition);
    }

    .modal-backdrop.active {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      width: 90%;
      max-width: 500px;
      background-color: white;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg);
      transform: translateY(-20px);
      transition: var(--transition);
    }

    .modal-backdrop.active .modal {
      transform: translateY(0);
    }

    .modal-header {
      padding: var(--spacing-4);
      border-bottom: 1px solid var(--neutral-200);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header h3 {
      margin: 0;
    }

    .modal-close {
      background: none;
      border: none;
      font-size: var(--font-size-xl);
      cursor: pointer;
      color: var(--neutral-600);
    }

    .modal-body {
      padding: var(--spacing-4);
    }

    .modal-footer {
      padding: var(--spacing-4);
      border-top: 1px solid var(--neutral-200);
      display: flex;
      justify-content: flex-end;
      gap: var(--spacing-3);
    }

    /* Toast Component */
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 10px 20px;
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-lg);
      z-index: 1100;
      transform: translateY(-20px);
      opacity: 0;
      transition: var(--transition);
    }

    .toast.active {
      transform: translateY(0);
      opacity: 1;
    }

    .toast-success {
      background-color: var(--primary-600);
      color: white;
    }

    .toast-error {
      background-color: var(--error-500);
      color: white;
    }

    .toast-warning {
      background-color: var(--warning-500);
      color: white;
    }

    .toast-content {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* Animations */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(249, 115, 22, 0.4);
      }
      70% {
        box-shadow: 0 0 0 10px rgba(249, 115, 22, 0);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(249, 115, 22, 0);
      }
    }

    /* Responsive Styles */
    @media (max-width: 768px) {
      .sidebar {
        position: fixed;
        left: -250px;
        height: 100%;
      }
      
      .sidebar.active {
        left: 0;
      }
      
      .toggle-sidebar {
        display: block;
      }
      
      .dashboard-content {
        width: 100%;
      }
      
      .form-row {
        flex-direction: column;
        gap: var(--spacing-3);
      }
      
      .stats-grid,
      .action-cards {
        grid-template-columns: 1fr;
      }
      
      .gauge {
        width: 150px;
        height: 75px;
      }
      
      .gauge-bg,
      .gauge-fill {
        width: 150px;
        height: 150px;
      }
      
      .gauge-cover {
        width: 100px;
        height: 50px;
        top: 10px;
        left: 25px;
      }
    }
  </style>
</head>
<body>
  <div id="app"></div>

  <script>
    // Configuration
    const CONFIG = {
      APP_NAME: 'BinBuddy',
      APP_VERSION: '1.0.0',
      
      STORAGE_KEYS: {
        USERS: 'binbuddy_users',
        ADMIN: 'binbuddy_admin',
        CURRENT_USER: 'binbuddy_current_user',
        WASTE_REQUESTS: 'binbuddy_waste_requests',
        WASTE_DATA: 'binbuddy_waste_data',
        BOTTLE_DATA: 'binbuddy_bottle_data',
        ISSUES: 'binbuddy_issues'
      },
      
      DEFAULT_ADMIN: {
        username: 'admin',
        password: 'admin',
        role: 'admin'
      },
      
      WASTE_SETTINGS: {
        MONTHLY_TARGET_KG: 20,
        BOTTLE_REWARD_RATE: 2,
        MAX_REWARD_AMOUNT: 500
      },
      
      UI: {
        ANIMATION_DURATION: 300,
        DEFAULT_TOAST_DURATION: 3000
      }
    };

    // Utility Functions
    function generateId() {
      return Date.now().toString(36) + Math.random().toString(36).slice(2);
    }

    function formatDate(date, includeTime = false) {
      const d = new Date(date);
      const day = d.getDate().toString().padStart(2, '0');
      const month = (d.getMonth() + 1).toString().padStart(2, '0');
      const year = d.getFullYear();
      
      let formatted = `${day}/${month}/${year}`;
      
      if (includeTime) {
        const hours = d.getHours().toString().padStart(2, '0');
        const minutes = d.getMinutes().toString().padStart(2, '0');
        formatted += ` ${hours}:${minutes}`;
      }
      
      return formatted;
    }

    function isValidEmail(email) {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return emailRegex.test(email);
    }

    function isValidPhone(phone) {
      const phoneRegex = /^\d{10}$/;
      return phoneRegex.test(phone);
    }

    function isValidPincode(pincode) {
      const pincodeRegex = /^\d{6}$/;
      return pincodeRegex.test(pincode);
    }

    function validateForm(data, requiredFields) {
      const errors = {};
      
      requiredFields.forEach(field => {
        if (!data[field] || data[field].trim() === '') {
          errors[field] = `${field.charAt(0).toUpperCase() + field.slice(1)} is required`;
        }
      });
      
      if (data.email && !isValidEmail(data.email)) {
        errors.email = 'Please enter a valid email address';
      }
      
      if (data.phone && !isValidPhone(data.phone)) {
        errors.phone = 'Phone number must be 10 digits';
      }
      
      if (data.pincode && !isValidPincode(data.pincode)) {
        errors.pincode = 'Pincode must be 6 digits';
      }
      
      return {
        isValid: Object.keys(errors).length === 0,
        errors
      };
    }

    function showToast(message, type = 'success', duration = CONFIG.UI.DEFAULT_TOAST_DURATION) {
      const existingToast = document.querySelector('.toast');
      if (existingToast) {
        existingToast.remove();
      }
      
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      toast.innerHTML = `
        <div class="toast-content">
          <i class="${type === 'success' ? 'fas fa-check-circle' : type === 'error' ? 'fas fa-exclamation-circle' : 'fas fa-exclamation-triangle'}"></i>
          <span>${message}</span>
        </div>
      `;
      
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.classList.add('active');
      }, 10);
      
      setTimeout(() => {
        toast.classList.remove('active');
        setTimeout(() => {
          toast.remove();
        }, 300);
      }, duration);
    }

    function getCurrentMonth() {
      const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
      
      return months[new Date().getMonth()];
    }

    function getDaysLeftInMonth() {
      const now = new Date();
      const lastDay = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
      return lastDay - now.getDate();
    }

    // Storage Management
    const Storage = {
      init() {
        if (!this.get(CONFIG.STORAGE_KEYS.USERS)) {
          this.set(CONFIG.STORAGE_KEYS.USERS, []);
        }
        
        if (!this.get(CONFIG.STORAGE_KEYS.ADMIN)) {
          this.set(CONFIG.STORAGE_KEYS.ADMIN, CONFIG.DEFAULT_ADMIN);
        }
        
        if (!this.get(CONFIG.STORAGE_KEYS.WASTE_REQUESTS)) {
          this.set(CONFIG.STORAGE_KEYS.WASTE_REQUESTS, []);
        }
        
        if (!this.get(CONFIG.STORAGE_KEYS.WASTE_DATA)) {
          this.set(CONFIG.STORAGE_KEYS.WASTE_DATA, {});
        }
        
        if (!this.get(CONFIG.STORAGE_KEYS.BOTTLE_DATA)) {
          this.set(CONFIG.STORAGE_KEYS.BOTTLE_DATA, {});
        }
        
        if (!this.get(CONFIG.STORAGE_KEYS.ISSUES)) {
          this.set(CONFIG.STORAGE_KEYS.ISSUES, []);
        }
      },
      
      get(key) {
        try {
          const item = localStorage.getItem(key);
          return item ? JSON.parse(item) : null;
        } catch (error) {
          console.error('Error getting data from localStorage:', error);
          return null;
        }
      },
      
      set(key, value) {
        try {
          localStorage.setItem(key, JSON.stringify(value));
        } catch (error) {
          console.error('Error setting data in localStorage:', error);
        }
      },
      
      remove(key) {
        try {
          localStorage.removeItem(key);
        } catch (error) {
          console.error('Error removing data from localStorage:', error);
        }
      },
      
      clear() {
        Object.values(CONFIG.STORAGE_KEYS).forEach(key => {
          this.remove(key);
        });
      },
      
      getUsers() {
        return this.get(CONFIG.STORAGE_KEYS.USERS) || [];
      },
      
      addUser(user) {
        const users = this.getUsers();
        
        if (users.some(u => u.username === user.username)) {
          throw new Error('Username already exists');
        }
        
        const newUser = {
          ...user,
          id: generateId(),
          createdAt: new Date().toISOString()
        };
        
        users.push(newUser);
        this.set(CONFIG.STORAGE_KEYS.USERS, users);
        
        const wasteData = this.get(CONFIG.STORAGE_KEYS.WASTE_DATA) || {};
        wasteData[newUser.id] = {
          total: 0,
          monthly: {},
          history: []
        };
        this.set(CONFIG.STORAGE_KEYS.WASTE_DATA, wasteData);
        
        const bottleData = this.get(CONFIG.STORAGE_KEYS.BOTTLE_DATA) || {};
        bottleData[newUser.id] = {
          total: 0,
          rewards: 0,
          history: []
        };
        this.set(CONFIG.STORAGE_KEYS.BOTTLE_DATA, bottleData);
        
        return newUser;
      },
      
      getUserByUsername(username) {
        const users = this.getUsers();
        return users.find(user => user.username === username) || null;
      },
      
      getUserById(id) {
        const users = this.getUsers();
        return users.find(user => user.id === id) || null;
      },
      
      updateUser(id, data) {
        const users = this.getUsers();
        const index = users.findIndex(user => user.id === id);
        
        if (index === -1) return null;
        
        if (data.username && data.username !== users[index].username) {
          const usernameExists = users.some(u => u.id !== id && u.username === data.username);
          if (usernameExists) {
            throw new Error('Username already exists');
          }
        }
        
        users[index] = { ...users[index], ...data, updatedAt: new Date().toISOString() };
        this.set(CONFIG.STORAGE_KEYS.USERS, users);
        
        return users[index];
      },
      
      setCurrentUser(user) {
        this.set(CONFIG.STORAGE_KEYS.CURRENT_USER, user);
      },
      
      getCurrentUser() {
        return this.get(CONFIG.STORAGE_KEYS.CURRENT_USER);
      },
      
      logout() {
        this.remove(CONFIG.STORAGE_KEYS.CURRENT_USER);
      },
      
      addWasteRequest(request) {
        const requests = this.get(CONFIG.STORAGE_KEYS.WASTE_REQUESTS) || [];
        
        const newRequest = {
          ...request,
          id: generateId(),
          status: 'pending',
          createdAt: new Date().toISOString()
        };
        
        requests.push(newRequest);
        this.set(CONFIG.STORAGE_KEYS.WASTE_REQUESTS, requests);
        
        return newRequest;
      },
      
      getWasteRequests(userId = null) {
        const requests = this.get(CONFIG.STORAGE_KEYS.WASTE_REQUESTS) || [];
        
        if (userId) {
          return requests.filter(req => req.userId === userId);
        }
        
        return requests;
      },
      
      updateWasteRequest(id, data) {
        const requests = this.get(CONFIG.STORAGE_KEYS.WASTE_REQUESTS) || [];
        const index = requests.findIndex(req => req.id === id);
        
        if (index === -1) return null;
        
        requests[index] = { ...requests[index], ...data, updatedAt: new Date().toISOString() };
        this.set(CONFIG.STORAGE_KEYS.WASTE_REQUESTS, requests);
        
        return requests[index];
      },
      
      addWasteCollection(userId, wasteKg, bottles) {
        const wasteData = this.get(CONFIG.STORAGE_KEYS.WASTE_DATA) || {};
        
        if (!wasteData[userId]) {
          wasteData[userId] = {
            total: 0,
            monthly: {},
            history: []
          };
        }
        
        const monthYear = `${new Date().getMonth() + 1}-${new Date().getFullYear()}`;
        
        wasteData[userId].total += wasteKg;
        wasteData[userId].monthly[monthYear] = (wasteData[userId].monthly[monthYear] || 0) + wasteKg;
        
        wasteData[userId].history.push({
          date: new Date().toISOString(),
          amount: wasteKg
        });
        
        this.set(CONFIG.STORAGE_KEYS.WASTE_DATA, wasteData);
        
        if (bottles > 0) {
          const bottleData = this.get(CONFIG.STORAGE_KEYS.BOTTLE_DATA) || {};
          
          if (!bottleData[userId]) {
            bottleData[userId] = {
              total: 0,
              rewards: 0,
              history: []
            };
          }
          
          const rewardAmount = bottles * CONFIG.WASTE_SETTINGS.BOTTLE_REWARD_RATE;
          
          bottleData[userId].total += bottles;
          bottleData[userId].rewards += rewardAmount;
          
          bottleData[userId].history.push({
            date: new Date().toISOString(),
            bottles: bottles,
            reward: rewardAmount
          });
          
          this.set(CONFIG.STORAGE_KEYS.BOTTLE_DATA, bottleData);
        }
        
        return {
          wasteData: wasteData[userId],
          bottleData: bottles > 0 ? this.get(CONFIG.STORAGE_KEYS.BOTTLE_DATA)[userId] : null
        };
      },
      
      getUserWasteData(userId) {
        const wasteData = this.get(CONFIG.STORAGE_KEYS.WASTE_DATA) || {};
        return wasteData[userId] || { total: 0, monthly: {}, history: [] };
      },
      
      getUserBottleData(userId) {
        const bottleData = this.get(CONFIG.STORAGE_KEYS.BOTTLE_DATA) || {};
        return bottleData[userId] || { total: 0, rewards: 0, history: [] };
      },
      
      getCurrentMonthWaste(userId) {
        const wasteData = this.getUserWasteData(userId);
        const monthYear = `${new Date().getMonth() + 1}-${new Date().getFullYear()}`;
        return wasteData.monthly[monthYear] || 0;
      },
      
      hasEarnedReward(userId) {
        const currentMonthWaste = this.getCurrentMonthWaste(userId);
        return currentMonthWaste >= CONFIG.WASTE_SETTINGS.MONTHLY_TARGET_KG;
      },
      
      addIssue(issue) {
        const issues = this.get(CONFIG.STORAGE_KEYS.ISSUES) || [];
        
        const newIssue = {
          ...issue,
          id: generateId(),
          status: 'open',
          createdAt: new Date().toISOString()
        };
        
        issues.push(newIssue);
        this.set(CONFIG.STORAGE_KEYS.ISSUES, issues);
        
        return newIssue;
      },
      
      getIssues(userId = null) {
        const issues = this.get(CONFIG.STORAGE_KEYS.ISSUES) || [];
        
        if (userId) {
          return issues.filter(issue => issue.userId === userId);
        }
        
        return issues;
      },
      
      updateIssue(id, data) {
        const issues = this.get(CONFIG.STORAGE_KEYS.ISSUES) || [];
        const index = issues.findIndex(issue => issue.id === id);
        
        if (index === -1) return null;
        
        issues[index] = { ...issues[index], ...data, updatedAt: new Date().toISOString() };
        this.set(CONFIG.STORAGE_KEYS.ISSUES, issues);
        
        return issues[index];
      }
    };

    // Components
    const Components = {
      createGaugeMeter(value, max, label, containerId) {
        const container = document.getElementById(containerId);
        if (!container) return;
        
        const percentage = (value / max) * 100;
        const rotation = (percentage * 1.8) > 180 ? 180 : (percentage * 1.8);
        
        container.innerHTML = `
          <div class="gauge-container">
            <div class="gauge">
              <div class="gauge-bg"></div>
              <div class="gauge-fill" style="transform: rotate(${rotation}deg)"></div>
              <div class="gauge-cover"></div>
            </div>
            <div class="gauge-value">${value.toFixed(1)} / ${max} kg</div>
            <div class="gauge-label">${label}</div>
          </div>
        `;
      },
      
      createModal(title, content, actions = []) {
        const existingModal = document.querySelector('.modal-backdrop');
        if (existingModal) {
          existingModal.remove();
        }
        
        const backdrop = document.createElement('div');
        backdrop.className = 'modal-backdrop';
        
        const modal = document.createElement('div');
        modal.className = 'modal';
        
        const header = document.createElement('div');
        header.className = 'modal-header';
        header.innerHTML = `
          <h3>${title}</h3>
          <button class="modal-close">&times;</button>
        `;
        
        const body = document.createElement('div');
        body.className = 'modal-body';
        body.innerHTML = content;
        
        const footer = document.createElement('div');
        footer.className = 'modal-footer';
        
        actions.forEach(action => {
          const button = document.createElement('button');
          button.className = `btn btn-${action.type || 'secondary'}`;
          button.textContent = action.label;
          button.addEventListener('click', () => {
            if (action.onClick) action.onClick();
            backdrop.classList.remove('active');
            setTimeout(() => backdrop.remove(), 300);
          });
          footer.appendChild(button);
        });
        
        modal.appendChild(header);
        modal.appendChild(body);
        modal.appendChild(footer);
        backdrop.appendChild(modal);
        
        document.body.appendChild(backdrop);
        
        const closeBtn = modal.querySelector('.modal-close');
        closeBtn.addEventListener('click', () => {
          backdrop.classList.remove('active');
          setTimeout(() => backdrop.remove(), 300);
        });
        
        backdrop.addEventListener('click', (e) => {
          if (e.target === backdrop) {
            backdrop.classList.remove('active');
            setTimeout(() => backdrop.remove(), 300);
          }
        });
        
        setTimeout(() => {
          backdrop.classList.add('active');
        }, 10);
        
        return backdrop;
      },
      
      confirmModal(title, message, onConfirm, onCancel = null) {
        this.createModal(
          title,
          `<p>${message}</p>`,
          [
            {
              label: 'Cancel',
              type: 'secondary',
              onClick: onCancel
            },
            {
              label: 'Confirm',
              type: 'primary',
              onClick: onConfirm
            }
          ]
        );
      },
      
      formModal(title, fields, onSubmit) {
        let formHtml = '<form id="modal-form">';
        
        fields.forEach(field => {
          formHtml += `<div class="form-group">`;
          
          if (field.type !== 'checkbox') {
            formHtml += `<label for="${field.name}">${field.label}</label>`;
          }
          
          if (field.type === 'select' && field.options) {
            formHtml += `
              <select id="${field.name}" name="${field.name}" class="form-control">
                ${field.options.map(opt => 
                  `<option value="${opt.value}" ${field.value === opt.value ? 'selected' : ''}>${opt.label}</option>`
                ).join('')}
              </select>
            `;
          } else if (field.type === 'textarea') {
            formHtml += `
              <textarea id="${field.name}" name="${field.name}" class="form-control" rows="4">${field.value || ''}</textarea>
            `;
          } else if (field.type === 'checkbox') {
            formHtml += `
              <label>
                <input type="${field.type}" id="${field.name}" name="${field.name}" ${field.value ? 'checked' : ''}>
                ${field.label}
              </label>
            `;
          } else {
            formHtml += `
              <input type="${field.type}" id="${field.name}" name="${field.name}" class="form-control" value="${field.value || ''}" ${field.required ? 'required' : ''}>
            `;
          }
          
          formHtml += `</div>`;
        });
        
        formHtml += '</form>';
        
        const modal = this.createModal(
          title,
          formHtml,
          [
            {
              label: 'Cancel',
              type: 'secondary'
            },
            {
              label: 'Submit',
              type: 'primary',
              onClick: () => {
                const form = document.getElementById('modal-form');
                if (!form) return;
                
                const formData = {};
                fields.forEach(field => {
                  const element = form.elements[field.name];
                  if (!element) return;
                  
                  if (field.type === 'checkbox') {
                    formData[field.name] = element.checked;
                  } else if (field.type === 'number') {
                    formData[field.name] = parseFloat(element.value) || 0;
                  } else {
                    formData[field.name] = element.value;
                  }
                });
                
                onSubmit(formData);
              }
            }
          ]
        );
        
        return modal;
      },
      
      toast(message, type = 'success') {
        showToast(message, type);
      }
    };

    // Authentication
    const Auth = {
      init() {
        document.addEventListener('click', (e) => {
          if (e.target.closest('.auth-tab')) {
            const tab = e.target.closest('.auth-tab');
            this.switchAuthTab(tab.dataset.tab);
          }
          
          if (e.target.closest('#login-form button[type="submit"]')) {
            e.preventDefault();
            this.handleLogin();
          }
          
          if (e.target.closest('#signup-form button[type="submit"]')) {
            e.preventDefault();
            this.handleSignup();
          }
          
          if (e.target.closest('#logout-btn')) {
            e.preventDefault();
            this.logout();
          }
        });
      },
      
      switchAuthTab(tab) {
        const tabs = document.querySelectorAll('.auth-tab');
        const forms = document.querySelectorAll('.auth-form');
        
        tabs.forEach(t => t.classList.remove('active'));
        forms.forEach(f => f.style.display = 'none');
        
        document.querySelector(`.auth-tab[data-tab="${tab}"]`).classList.add('active');
        document.querySelector(`#${tab}-form`).style.display = 'block';
      },
      
      handleLogin() {
        const username = document.getElementById('login-username').value.trim();
        const password = document.getElementById('login-password').value.trim();
        const errorElement = document.getElementById('login-error');
        
        if (!username || !password) {
          errorElement.textContent = 'Please enter both username and password';
          errorElement.style.display = 'block';
          return;
        }
        
        const admin = Storage.get(CONFIG.STORAGE_KEYS.ADMIN);
        if (username === admin.username && password === admin.password) {
          Storage.setCurrentUser({ ...admin, role: 'admin' });
          Components.toast('Admin login successful!', 'success');
          this.redirectToDashboard('admin');
          return;
        }
        
        const user = Storage.getUserByUsername(username);
        if (!user || user.password !== password) {
          errorElement.textContent = 'Invalid username or password';
          errorElement.style.display = 'block';
          return;
        }
        
        Storage.setCurrentUser({ ...user, role: 'user' });
        Components.toast('Login successful!', 'success');
        this.redirectToDashboard('user');
      },
      
      handleSignup() {
        const form = document.getElementById('signup-form');
        const errorElement = document.getElementById('signup-error');
        
        const userData = {
          name: document.getElementById('signup-name').value.trim(),
          houseName: document.getElementById('signup-house').value.trim(),
          address: document.getElementById('signup-address').value.trim(),
          panchayat: document.getElementById('signup-panchayat').value.trim(),
          pincode: document.getElementById('signup-pincode').value.trim(),
          phone: document.getElementById('signup-phone').value.trim(),
          username: document.getElementById('signup-username').value.trim(),
          password: document.getElementById('signup-password').value.trim(),
          role: 'user'
        };
        
        const requiredFields = ['name', 'houseName', 'address', 'panchayat', 'pincode', 'phone', 'username', 'password'];
        const validation = validateForm(userData, requiredFields);
        
        if (!validation.isValid) {
          const errorMessage = Object.values(validation.errors)[0];
          errorElement.textContent = errorMessage;
          errorElement.style.display = 'block';
          return;
        }
        
        try {
          const newUser = Storage.addUser(userData);
          Storage.setCurrentUser({ ...newUser, role: 'user' });
          Components.toast('Signup successful! Welcome to BinBuddy.', 'success');
          this.redirectToDashboard('user');
        } catch (error) {
          errorElement.textContent = error.message || 'An error occurred during signup';
          errorElement.style.display = 'block';
        }
      },
      
      logout() {
        Storage.logout();
        Components.toast('You have been logged out', 'success');
        this.redirectToLogin();
      },
      
      isLoggedIn() {
        return !!Storage.getCurrentUser();
      },
      
      isAdmin() {
        const user = Storage.getCurrentUser();
        return user && user.role === 'admin';
      },
      
      redirectToDashboard(role) {
        if (role === 'admin') {
          App.loadAdminDashboard();
        } else {
          App.loadUserDashboard();
        }
      },
      
      redirectToLogin() {
        App.loadLoginPage();
      },
      
      renderLoginPage() {
        return `
          <div class="auth-page">
            <div class="auth-container">
              <div class="auth-logo">
                <h1><i class="fas fa-recycle"></i> ${CONFIG.APP_NAME}</h1>
                <p>Eco-friendly waste management</p>
              </div>
              
              <div class="auth-tabs">
                <div class="auth-tab active" data-tab="login">Login</div>
                <div class="auth-tab" data-tab="signup">Sign Up</div>
              </div>
              
              <div class="auth-form" id="login-form" style="display: block;">
                <h2>Welcome Back</h2>
                
                <div class="alert alert-error" id="login-error" style="display: none;"></div>
                
                <div class="form-group">
                  <label for="login-username">Username</label>
                  <input type="text" id="login-username" class="form-control" placeholder="Enter your username">
                </div>
                
                <div class="form-group">
                  <label for="login-password">Password</label>
                  <input type="password" id="login-password" class="form-control" placeholder="Enter your password">
                </div>
                
                <button type="submit" class="btn btn-primary btn-block">Login</button>
              </div>
              
              <div class="auth-form" id="signup-form" style="display: none;">
                <h2>Create Account</h2>
                
                <div class="alert alert-error" id="signup-error" style="display: none;"></div>
                
                <div class="form-group">
                  <label for="signup-name">Full Name</label>
                  <input type="text" id="signup-name" class="form-control" placeholder="Enter your full name">
                </div>
                
                <div class="form-group">
                  <label for="signup-house">House Name</label>
                  <input type="text" id="signup-house" class="form-control" placeholder="Enter your house name">
                </div>
                
                <div class="form-group">
                  <label for="signup-address">Address</label>
                  <textarea id="signup-address" class="form-control" placeholder="Enter your address"></textarea>
                </div>
                
                <div class="form-group">
                  <label for="signup-panchayat">Panchayat Name</label>
                  <input type="text" id="signup-panchayat" class="form-control" placeholder="Enter your panchayat name">
                </div>
                
                <div class="form-group">
                  <label for="signup-pincode">Pincode</label>
                  <input type="text" id="signup-pincode" class="form-control" placeholder="Enter 6-digit pincode">
                </div>
                
                <div class="form-group">
                  <label for="signup-phone">Phone Number</label>
                  <input type="text" id="signup-phone" class="form-control" placeholder="Enter 10-digit phone number">
                </div>
                
                <div class="form-group">
                  <label for="signup-username">Username</label>
                  <input type="text" id="signup-username" class="form-control" placeholder="Choose a username">
                </div>
                
                <div class="form-group">
                  <label for="signup-password">Password</label>
                  <input type="password" id="signup-password" class="form-control" placeholder="Choose a password">
                </div>
                
                <button type="submit" class="btn btn-primary btn-block">Sign Up</button>
              </div>
              
              <div class="auth-footer">
                <p>&copy; ${new Date().getFullYear()} ${CONFIG.APP_NAME}. All rights reserved.</p>
              </div>
            </div>
          </div>
        `;
      }
    };

    // User Dashboard
    const UserDashboard = {
      init() {
        this.setupEventListeners();
        this.refreshDashboardData();
      },
      
      setupEventListeners() {
        document.addEventListener('click', (e) => {
          if (e.target.closest('.toggle-sidebar')) {
            this.toggleSidebar();
          }
          
          if (e.target.closest('#action-waste-collection')) {
            this.showWasteCollectionForm();
          }
          
          if (e.target.closest('#action-waste-dropoff')) {
            this.showWasteDropoffForm();
          }
          
          if (e.target.closest('#action-bottle-exchange')) {
            this.showBottleExchangeForm();
          }
          
          if (e.target.closest('#action-submit-issue')) {
            this.showSubmitIssueForm();
          }
        });
      },
      
      toggleSidebar() {
        const sidebar = document.querySelector('.sidebar');
        sidebar.classList.toggle('active');
      },
      
      refreshDashboardData() {
        const user = Storage.getCurrentUser();
        if (!user) return;
        
        const wasteData = Storage.getUserWasteData(user.id);
        const bottleData = Storage.getUserBottleData(user.id);
        const currentMonthWaste = Storage.getCurrentMonthWaste(user.id);
        const hasEarnedReward = Storage.hasEarnedReward(user.id);
        
        Components.createGaugeMeter(
          currentMonthWaste,
          CONFIG.WASTE_SETTINGS.MONTHLY_TARGET_KG,
          `Monthly Target (${getCurrentMonth()})`,
          'waste-gauge'
        );
        
        document.getElementById('total-waste').textContent = wasteData.total.toFixed(1) + ' kg';
        document.getElementById('month-waste').textContent = currentMonthWaste.toFixed(1) + ' kg';
        document.getElementById('total-bottles').textContent = bottleData.total + ' bottles';
        document.getElementById('total-rewards').textContent = '₹' + bottleData.rewards.toFixed(2);
        
        const rewardBadge = document.getElementById('reward-badge');
        if (hasEarnedReward) {
          rewardBadge.style.display = 'block';
        } else {
          rewardBadge.style.display = 'none';
        }
        
        document.getElementById('days-remaining').textContent = getDaysLeftInMonth();
        
        const requests = Storage.getWasteRequests(user.id).slice(0, 5);
        const requestsList = document.getElementById('recent-requests');
        
        if (requests.length === 0) {
          requestsList.innerHTML = '<p>No recent requests</p>';
        } else {
          requestsList.innerHTML = requests.map(request => `
            <div class="request-item">
              <div class="request-date">${formatDate(request.createdAt, true)}</div>
              <div class="request-type">${request.type === 'collection' ? 'Home Collection' : 'Center Drop-off'}</div>
              <div class="request-status">
                <span class="badge ${request.status === 'pending' ? 'badge-warning' : 'badge-success'}">
                  ${request.status === 'pending' ? 'Pending' : 'Completed'}
                </span>
              </div>
            </div>
          `).join('');
        }
      },
      
      showWasteCollectionForm() {
        const user = Storage.getCurrentUser();
        if (!user) return;
        
        Components.formModal(
          'Request Waste Collection',
          [
            {
              name: 'date',
              label: 'Preferred Date',
              type: 'date',
              value: new Date().toISOString().split('T')[0],
              required: true
            },
            {
              name: 'time',
              label: 'Preferred Time',
              type: 'select',
              options: [
                { value: 'morning', label: 'Morning (8AM - 12PM)' },
                { value: 'afternoon', label: 'Afternoon (12PM - 4PM)' },
                { value: 'evening', label: 'Evening (4PM - 7PM)' }
              ],
              value: 'morning'
            },
            {
              name: 'notes',
              label: 'Additional Notes',
              type: 'textarea',
              value: ''
            }
          ],
          (formData) => {
            const request = {
              userId: user.id,
              type: 'collection',
              preferredDate: formData.date,
              preferredTime: formData.time,
              notes: formData.notes
            };
            
            Storage.addWasteRequest(request);
            Components.toast('Waste collection request submitted successfully!', 'success');
            this.refreshDashboardData();
          }
        );
      },
      
      showWasteDropoffForm() {
        const user = Storage.getCurrentUser();
        if (!user) return;
        
        Components.formModal(
          'Notify Waste Drop-off',
          [
            {
              name: 'date',
              label: 'Drop-off Date',
              type: 'date',
              value: new Date().toISOString().split('T')[0],
              required: true
            },
            {
              name: 'center',
              label: 'Drop-off Center',
              type: 'select',
              options: [
                { value: 'center1', label: 'Main Recycling Center' },
                { value: 'center2', label: 'Community Collection Point' },
                { value: 'center3', label: 'Municipal Waste Station' }
              ],
              value: 'center1'
            },
            {
              name: 'wasteEstimate',
              label: 'Estimated Waste (kg)',
              type: 'number',
              value: '5'
            },
            {
              name: 'bottlesEstimate',
              label: 'Estimated Bottles',
              type: 'number',
              value: '0'
            }
          ],
          (formData) => {
            const request = {
              userId: user.id,
              type: 'dropoff',
              dropDate: formData.date,
              center: formData.center,
              wasteEstimate: parseFloat(formData.wasteEstimate) || 0,
              bottlesEstimate: parseInt(formData.bottlesEstimate) || 0
            };
            
            Storage.addWasteRequest(request);
            Components.toast('Drop-off notification submitted successfully!', 'success');
            this.refreshDashboardData();
          }
        );
      },
      
      showBottleExchangeForm() {
        Components.formModal(
          'Exchange Plastic Bottles',
          [
            {
              name: 'bottleCount',
              label: 'Number of Bottles',
              type: 'number',
              value: '1'
            },
            {
              name: 'info',
              label: `Reward Rate: ₹${CONFIG.WASTE_SETTINGS.BOTTLE_REWARD_RATE} per bottle`,
              type: 'hidden',
              value: ''
            }
          ],
          (formData) => {
            const user = Storage.getCurrentUser();
            if (!user) return;
            
            const bottleCount = parseInt(formData.bottleCount) || 0;
            
            if (bottleCount <= 0) {
              Components.toast('Please enter a valid number of bottles', 'error');
              return;
            }
            
            Storage.addWasteCollection(user.id, 0, bottleCount);
            
            const reward = bottleCount * CONFIG.WASTE_SETTINGS.BOTTLE_REWARD_RATE;
            Components.toast(`${bottleCount} bottles exchanged successfully! You earned ₹${reward.toFixed(2)}.`, 'success');
            this.refreshDashboardData();
          }
        );
      },
      
      showSubmitIssueForm() {
        const user = Storage.getCurrentUser();
        if (!user) return;
        
        Components.formModal(
          'Submit Issue or Problem',
          [
            {
              name: 'title',
              label: 'Issue Title',
              type: 'text',
              value: '',
              required: true
            },
            {
              name: 'category',
              label: 'Category',
              type: 'select',
              options: [
                { value: 'collection', label: 'Waste Collection' },
                { value: 'app', label: 'App Issue' },
                { value: 'suggestion', label: 'Suggestion' },
                { value: 'other', label: 'Other' }
              ],
              value: 'collection'
            },
            {
              name: 'description',
              label: 'Description',
              type: 'textarea',
              value: '',
              required: true
            }
          ],
          (formData) => {
            const issue = {
              userId: user.id,
              userName: user.name,
              title: formData.title,
              category: formData.category,
              description: formData.description
            };
            
            Storage.addIssue(issue);
            Components.toast('Issue submitted successfully!', 'success');
          }
        );
      },
      
      render() {
        const user = Storage.getCurrentUser();
        if (!user) return '';
        
        return `
          <div class="dashboard">
            <div class="sidebar">
              <div class="sidebar-header">
                <i class="fas fa-recycle"></i>
                <h2>${CONFIG.APP_NAME}</h2>
              </div>
              
              <ul class="sidebar-nav">
                <li>
                  <a href="#" class="sidebar-link active">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                  </a>
                </li>
                <li>
                  <a href="#" class="sidebar-link" id="action-waste-collection">
                    <i class="fas fa-trash"></i>
                    <span>Request Collection</span>
                  </a>
                </li>
                <li>
                  <a href="#" class="sidebar-link" id="action-waste-dropoff">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>Drop Off Waste</span>
                  </a>
                </li>
                <li>
                  <a href="#" class="sidebar-link" id="action-bottle-exchange">
                    <i class="fas fa-exchange-alt"></i>
                    <span>Exchange Bottles</span>
                  </a>
                </li>
                <li>
                  <a href="#" class="sidebar-link" id="action-submit-issue">
                    <i class="fas fa-exclamation-circle"></i>
                    <span>Report Issue</span>
                  </a>
                </li>
                <li>
                  <a href="#" class="sidebar-link" id="logout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                  </a>
                </li>
              </ul>
            </div>
            
            <div class="dashboard-content">
              <div class="dashboard-header">
                <div class="toggle-sidebar">
                  <i class="fas fa-bars"></i>
                </div>
                
                <div class="user-menu">
                  <span>Welcome, ${user.name}</span>
                </div>
              </div>
              
              <div class="main-content">
                <h1>Welcome to Your Waste Management Dashboard</h1>
                
                <div id="reward-badge" class="reward-badge" style="display: none;">
                  <i class="fas fa-award"></i> Congratulations! You've earned a reward!
                </div>
                
                <div class="stats-grid">
                  <div class="stat-card">
                    <div class="stat-icon green">
                      <i class="fas fa-weight-scale"></i>
                    </div>
                    <div class="stat-value" id="total-waste">0 kg</div>
                    <div class="stat-label">Total Waste Collected</div>
                  </div>
                  
                  <div class="stat-card">
                    <div class="stat-icon blue">
                      <i class="fas fa-calendar-check"></i>
                    </div>
                    <div class="stat-value" id="month-waste">0 kg</div>
                    <div class="stat-label">This Month's Collection</div>
                  </div>
                  
                  <div class="stat-card">
                    <div class="stat-icon orange">
                      <i class="fas fa-bottle-water"></i>
                    </div>
                    <div class="stat-value" id="total-bottles">0 bottles</div>
                    <div class="stat-label">Bottles Exchanged</div>
                  </div>
                  
                  <div class="stat-card">
                    <div class="stat-icon green">
                      <i class="fas fa-coins"></i>
                    </div>
                    <div class="stat-value" id="total-rewards">₹0.00</div>
                    <div class="stat-label">Total Rewards Earned</div>
                  </div>
                </div>
                
                <div class="card">
                  <div class="card-header">
                    <h2>Monthly Target Progress</h2>
                    <span>
                      <i class="fas fa-calendar"></i> 
                      <span id="days-remaining">0</span> days remaining this month
                    </span>
                  </div>
                  
                  <div id="waste-gauge"></div>
                </div>
                
                <h2>Quick Actions</h2>
                
                <div class="action-cards">
                  <div class="action-card" id="action-waste-collection">
                    <h3><i class="fas fa-trash"></i> Request Waste Collection</h3>
                    <p>Schedule a pickup from your home for waste collection</p>
                    <button class="btn btn-primary">Request Pickup</button>
                  </div>
                  
                  <div class="action-card" id="action-waste-dropoff">
                    <h3><i class="fas fa-map-marker-alt"></i> Drop Waste at Center</h3>
                    <p>Notify that you've dropped waste at a collection center</p>
                    <button class="btn btn-primary">Notify Dropoff</button>
                  </div>
                  
                  <div class="action-card" id="action-bottle-exchange">
                    <h3><i class="fas fa-exchange-alt"></i> Exchange Plastic Bottles</h3>
                    <p>Get rewards for your plastic bottles at ₹${CONFIG.WASTE_SETTINGS.BOTTLE_REWARD_RATE} per bottle</p>
                    <button class="btn btn-primary">Exchange Now</button>
                  </div>
                  
                  <div class="action-card" id="action-submit-issue">
                    <h3><i class="fas fa-exclamation-circle"></i> Report an Issue</h3>
                    <p>Submit any problems or suggestions related to waste management</p>
                    <button class="btn btn-primary">Submit Issue</button>
                  </div>
                </div>
                
                <div class="card">
                  <div class="card-header">
                    <h2>Recent Requests</h2>
                  </div>
                  
                  <div id="recent-requests"></div>
                </div>
              </div>
            </div>
          </div>
        `;
      }
    };

    // Admin Dashboard
    const AdminDashboard = {
      init() {
        this.setupEventListeners();
        this.refreshDashboardData();
      },
      
      setupEventListeners() {
        document.addEventListener('click', (e) => {
          if (e.target.closest('.toggle-sidebar')) {
            this.toggleSidebar();
          }
          
          if (e.target.closest('#sort-by-panchayat')) {
            this.sortUsersByPanchayat();
          }
          
          if (e.target.closest('#verify-collection-btn')) {
            this.showVerifyCollectionForm();
          }
          
          if (e.target.closest('#view-issues-btn')) {
            this.showIssuesList();
          }
          
          if (e.target.closest('.update-request-status')) {
            const requestId = e.target.closest('.update-request-status').dataset.id;
            this.updateRequestStatus(requestId);
          }
        });
      },
      
      toggleSidebar() {
        const sidebar = document.querySelector('.sidebar');
        sidebar.classList.toggle('active');
      },
      
      refreshDashboardData() {
        const users = Storage.getUsers();
        document.getElementById('total-users').textContent = users.length;
        
        const allRequests = Storage.getWasteRequests();
        const pendingRequests = allRequests.filter(req => req.status === 'pending');
        document.getElementById('pending-requests').textContent = pendingRequests.length;
        
        const allIssues = Storage.getIssues();
        const openIssues = allIssues.filter(issue => issue.status === 'open');
        document.getElementById('open-issues').textContent = openIssues.length;
        
        let totalWaste = 0;
        const wasteData = Storage.get(CONFIG.STORAGE_KEYS.WASTE_DATA) || {};
        
        Object.values(wasteData).forEach(userData => {
          totalWaste += userData.total || 0;
        });
        
        document.getElementById('total-waste-collected').textContent = totalWaste.toFixed(1) + ' kg';
        
        this.renderUsersTable(users);
        this.renderRequestsTable(allRequests);
      },
      
      renderUsersTable(users) {
        const tableBody = document.getElementById('users-table-body');
        if (!tableBody) return;
        
        if (users.length === 0) {
          tableBody.innerHTML = `
            <tr>
              <td colspan="7" class="text-center">No users registered yet</td>
            </tr>
          `;
          return;
        }
        
        tableBody.innerHTML = users.map(user => {
          const wasteData = Storage.getUserWasteData(user.id);
          const bottleData = Storage.getUserBottleData(user.id);
          const hasReward = Storage.hasEarnedReward(user.id);
          
          return `
            <tr>
              <td>${user.name}</td>
              <td>${user.panchayat}</td>
              <td>${user.phone}</td>
              <td>${wasteData.total.toFixed(1)} kg</td>
              <td>${bottleData.total}</td>
              <td>${hasReward ? '<span class="badge badge-success">Yes</span>' : 'No'}</td>
              <td>${formatDate(user.createdAt)}</td>
            </tr>
          `;
        }).join('');
      },
      
      renderRequestsTable(requests) {
        const tableBody = document.getElementById('requests-table-body');
        if (!tableBody) return;
        
        if (requests.length === 0) {
          tableBody.innerHTML = `
            <tr>
              <td colspan="6" class="text-center">No requests yet</td>
            </tr>
          `;
          return;
        }
        
        tableBody.innerHTML = requests.map(request => {
          const user = Storage.getUserById(request.userId);
          
          return `
            <tr>
              <td>${formatDate(request.createdAt)}</td>
              <td>${user ? user.name : 'Unknown User'}</td>
              <td>${request.type === 'collection' ? 'Home Collection' : 'Center Drop-off'}</td>
              <td>
                ${request.type === 'collection' 
                  ? `${formatDate(request.preferredDate)} (${request.preferredTime})`
                  : formatDate(request.dropDate)
                }
              </td>
              <td>
                <span class="badge ${request.status === 'pending' ? 'badge-warning' : 'badge-success'}">
                  ${request.status === 'pending' ? 'Pending' : 'Completed'}
                </span>
              </td>
              <td>
                ${request.status === 'pending' 
                  ? `<button class="btn btn-primary btn-sm update-request-status" data-id="${request.id}">Mark Complete</button>`
                  : 'Completed'
                }
              </td>
            </tr>
          `;
        }).join('');
      },
      
      sortUsersByPanchayat() {
        const users = Storage.getUsers();
        const sortedUsers = [...users].sort((a, b) => {
          return a.panchayat.localeCompare(b.panchayat);
        });
        this.renderUsersTable(sortedUsers);
      },
      
      showVerifyCollectionForm() {
        const users = Storage.getUsers();
        
        if (users.length === 0) {
          Components.toast('No users registered yet', 'error');
          return;
        }
        
        const userOptions = users.map(user => ({
          value: user.id,
          label: `${user.name} (${user.panchayat})`
        }));
        
        Components.formModal(
          'Verify Waste Collection',
          [
            {
              name: 'date',
              label: 'Collection Date',
              type: 'date',
              value: new Date().toISOString().split('T')[0],
              required: true
            },
            {
              name: 'userId',
              label: 'Select User',
              type: 'select',
              options: userOptions,
              value: userOptions[0]?.value || ''
            },
            {
              name: 'wasteKg',
              label: 'Waste Collected (kg)',
              type: 'number',
              value: '0'
            },
            {
              name: 'bottles',
              label: 'Bottles Collected',
              type: 'number',
              value: '0'
            }
          ],
          (formData) => {
            const userId = formData.userId;
            const wasteKg = parseFloat(formData.wasteKg) || 0;
            const bottles = parseInt(formData.bottles) || 0;
            
            if (wasteKg <= 0 && bottles <= 0) {
              Components.toast('Please enter valid waste or bottle amounts', 'error');
              return;
            }
            
            Storage.addWasteCollection(userId, wasteKg, bottles);
            
            const pendingRequests = Storage.getWasteRequests(userId)
              .filter(req => req.status === 'pending')
              .slice(0, 1);
            
            if (pendingRequests.length > 0) {
              Storage.updateWasteRequest(pendingRequests[0].id, { 
                status: 'completed',
                actualKg: wasteKg,
                actualBottles: bottles
              });
            }
            
            Components.toast('Waste collection verified successfully!', 'success');
            this.refreshDashboardData();
          }
        );
      },
      
      showIssuesList() {
        const issues = Storage.getIssues();
        
        if (issues.length === 0) {
          Components.toast('No issues reported yet', 'info');
          return;
        }
        
        let issuesHtml = `
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Date</th>
                  <th>User</th>
                  <th>Category</th>
                  <th>Title</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
        `;
        
        issuesHtml += issues.map(issue => `
          <tr>
            <td>${formatDate(issue.createdAt)}</td>
            <td>${issue.userName || 'Unknown'}</td>
            <td>${issue.category}</td>
            <td>${issue.title}</td>
            <td>
              <span class="badge ${issue.status === 'open' ? 'badge-warning' : 'badge-success'}">
                ${issue.status === 'open' ? 'Open' : 'Resolved'}
              </span>
            </td>
          </tr>
        `).join('');
        
        issuesHtml += `
              </tbody>
            </table>
          </div>
        `;
        
        Components.createModal(
          'Reported Issues',
          issuesHtml,
          [
            {
              label: 'Close',
              type: 'secondary'
            }
          ]
        );
      },
      
      updateRequestStatus(requestId) {
        Components.confirmModal(
          'Confirm Status Update',
          'Are you sure you want to mark this request as completed?',
          () => {
            Storage.updateWasteRequest(requestId, { status: 'completed' });
            Components.toast('Request status updated successfully!', 'success');
            this.refreshDashboardData();
          }
        );
      },
      
      render() {
        return `
          <div class="dashboard">
            <div class="sidebar">
              <div class="sidebar-header">
                <i class="fas fa-recycle"></i>
                <h2>${CONFIG.APP_NAME}</h2>
              </div>
              
              <ul class="sidebar-nav">
                <li>
                  <a href="#" class="sidebar-link active">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                  </a>
                </li>
                <li>
                  <a href="#" class="sidebar-link" id="verify-collection-btn">
                    <i class="fas fa-check-circle"></i>
                    <span>Verify Collection</span>
                  </a>
                </li>
                <li>
                  <a href="#" class="sidebar-link" id="view-issues-btn">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>View Issues</span>
                  </a>
                </li>
                <li>
                  <a href="#" class="sidebar-link" id="logout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                  </a>
                </li>
              </ul>
            </div>
            
            <div class="dashboard-content">
              <div class="dashboard-header">
                <div class="toggle-sidebar">
                  <i class="fas fa-bars"></i>
                </div>
                
                <div class="user-menu">
                  <span>Admin Dashboard</span>
                </div>
              </div>
              
              <div class="main-content">
                <h1>Admin Dashboard</h1>
                
                <div class="stats-grid">
                  <div class="stat-card">
                    <div class="stat-icon green">
                      <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-value" id="total-users">0</div>
                    <div class="stat-label">Registered Users</div>
                  </div>
                  
                  <div class="stat-card">
                    <div class="stat-icon blue">
                      <i class="fas fa-truck"></i>
                    </div>
                    <div class="stat-value" id="pending-requests">0</div>
                    <div class="stat-label">Pending Requests</div>
                  </div>
                  
                  <div class="stat-card">
                    <div class="stat-icon orange">
                      <i class="fas fa-exclamation-circle"></i>
                    </div>
                    <div class="stat-value" id="open-issues">0</div>
                    <div class="stat-label">Open Issues</div>
                  </div>
                  
                  <div class="stat-card">
                    <div class="stat-icon green">
                      <i class="fas fa-weight-scale"></i>
                    </div>
                    <div class="stat-value" id="total-waste-collected">0 kg</div>
                    <div class="stat-label">Total Waste Collected</div>
                  </div>
                </div>
                
                <div class="card">
                  <div class="card-header">
                    <h2>Registered Users</h2>
                    <button class="btn btn-secondary" id="sort-by-panchayat">
                      <i class="fas fa-sort"></i> Sort by Panchayat
                    </button>
                  </div>
                  
                  <div class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>Name</th>
                          <th>Panchayat</th>
                          <th>Phone</th>
                          <th>Total Waste</th>
                          <th>Bottles</th>
                          <th>Earned Reward</th>
                          <th>Joined On</th>
                        </tr>
                      </thead>
                      <tbody id="users-table-body">
                        <!-- Users will be populated here -->
                      </tbody>
                    </table>
                  </div>
                </div>
                
                <div class="card">
                  <div class="card-header">
                    <h2>Waste Collection Requests</h2>
                  </div>
                  
                  <div class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>Date</th>
                          <th>User</th>
                          <th>Type</th>
                          <th>Scheduled For</th>
                          <th>Status</th>
                          <th>Action</th>
                        </tr>
                      </thead>
                      <tbody id="requests-table-body">
                        <!-- Requests will be populated here -->
                      </tbody>
                    </table>
                  </div>
                </div>
                
                <div class="form-card">
                  <h3><i class="fas fa-check-circle"></i> Verify Waste Collection</h3>
                  <p>Record waste collection for a user</p>
                  <button class="btn btn-primary" id="verify-collection-btn">Verify Collection</button>
                </div>
              </div>
            </div>
          </div>
        `;
      }
    };

    // Main Application
    const App = {
      init() {
        Storage.init();
        
        const currentUser = Storage.getCurrentUser();
        
        if (currentUser) {
          if (currentUser.role === 'admin') {
            this.loadAdminDashboard();
          } else {
            this.loadUserDashboard();
          }
        } else {
          this.loadLoginPage();
        }
        
        Auth.init();
      },
      
      loadLoginPage() {
        document.getElementById('app').innerHTML = Auth.renderLoginPage();
      },
      
      loadUserDashboard() {
        document.getElementById('app').innerHTML = UserDashboard.render();
        UserDashboard.init();
      },
      
      loadAdminDashboard() {
        document.getElementById('app').innerHTML = AdminDashboard.render();
        AdminDashboard.init();
      }
    };

    // Initialize the application
    document.addEventListener('DOMContentLoaded', () => {
      App.init();
    });
  </script>
</body>
</html>
